name: Restore Multiple Folders

on:
  workflow_dispatch:  # 手动触发

jobs:
  restore:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout latest commit
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # 保证能访问历史 commit

      - name: Checkout deleted commit as temp
        run: |
          git fetch origin b7e9c069a3eba5fe8c14a8c79b8688f1ec9dfc47
          git checkout b7e9c069a3eba5fe8c14a8c79b8688f1ec9dfc47

      - name: Copy folders from old commit
        run: |
          mkdir -p temp_restore
          cp -r Modules/Loon/Kelee temp_restore/
          cp -r Modules/Surge/Kelee temp_restore/
          cp -r Modules/Shadowrocket/Kelee temp_restore/

      - name: Switch back to main and restore folders
        run: |
          git checkout main

          rm -rf Modules/Loon/Kelee
          rm -rf Modules/Surge/Kelee
          rm -rf Modules/Shadowrocket/Kelee

          cp -r temp_restore/Kelee Modules/Loon/
          cp -r temp_restore/Kelee Modules/Surge/
          cp -r temp_restore/Kelee Modules/Shadowrocket/

      - name: Commit restored files
        run: |
          git config --global user.name "${GITHUB_ACTOR}"
          git config --global user.email "${GITHUB_ACTOR}@users.noreply.github.com"
          git add.
          git commit -m "Restore folder. from deleted commit"
          git push
